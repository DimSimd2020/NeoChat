# NeoChat: SMS Fallback Mode ‚Äî –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

## –ü—Ä–æ–±–ª–µ–º–∞
–í –†–§ –∏ –ø–æ—Ö–æ–∂–∏—Ö —Ä–µ–≥–∏–æ–Ω–∞—Ö –º–æ–±–∏–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –¥–ª—è –≤—Å–µ—Ö –¥–æ–º–µ–Ω–æ–≤, –∫—Ä–æ–º–µ
yandex.ru, gosuslugi.ru, –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–æ–≤ –∏ —Ç.–¥. P2P-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ.

## –†–µ—à–µ–Ω–∏–µ: –¥–≤–∞ —Ä–µ–∂–∏–º–∞ —Å–≤—è–∑–∏

### –†–µ–∂–∏–º 1 ‚Äî Internet (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- –®–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π P2P —á–µ—Ä–µ–∑ QUIC/WebRTC
- –ö–ª—é—á–∏ X25519, —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ AES-256-GCM
- –†–∞–±–æ—Ç–∞–µ—Ç, –∫–æ–≥–¥–∞ –µ—Å—Ç—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç

### –†–µ–∂–∏–º 2 ‚Äî SMS Fallback
- –°–æ–æ–±—â–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ –æ–±—ã—á–Ω—ã–µ –°–ú–° –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞
- **–®–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ!** –¢–µ–∫—Å—Ç —à–∏—Ñ—Ä—É–µ—Ç—Å—è AES-256-GCM + Base64 –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
- –ö–∞–∂–¥–∞—è –°–ú–° ‚â§ 160 —Å–∏–º–≤–æ–ª–æ–≤ (7-bit) –∏–ª–∏ 70 —Å–∏–º–≤–æ–ª–æ–≤ (Unicode)
- Base64(AES-256-GCM(—Ç–µ–∫—Å—Ç)) ‚âà 100 —Å–∏–º–≤–æ–ª–æ–≤ –Ω–∞ –°–ú–° ‚Üí ~60 —Å–∏–º–≤–æ–ª–æ–≤ —Ä–µ–∞–ª—å–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
- –î–ª–∏–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Ä–∞–∑–±–∏–≤–∞—é—Ç—Å—è –Ω–∞ –º—É–ª—å—Ç–∏–ø–∞—Ä—Ç-–°–ú–° —Å –∑–∞–≥–æ–ª–æ–≤–∫–æ–º

### –ö–∞–∫ —ç—Ç–æ –≤—ã–≥–ª—è–¥–∏—Ç

```
[–ß–∞—Ç —Å –ê–ª–µ–∫—Å–µ–π]
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üåê –ò–Ω—Ç–µ—Ä–Ω–µ—Ç ‚îÇ üì± SMS ‚îÇ    ‚Üê –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –≤ —à–∞–ø–∫–µ —á–∞—Ç–∞
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

–†–µ–∂–∏–º SMS –∞–∫—Ç–∏–≤–µ–Ω
‚ö†Ô∏è –°–æ–æ–±—â–µ–Ω–∏—è —Ç–∞—Ä–∏—Ñ–∏—Ü–∏—Ä—É—é—Ç—Å—è –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–º
```

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ SMS –Ω–∞ Desktop

### Desktop ‚Üí Android Bridge
Desktop —Å–∞–º –Ω–µ –º–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å SMS. –í–∞—Ä–∏–∞–Ω—Ç—ã:
1. **Android-companion** ‚Äî —Ç–µ–ª–µ—Ñ–æ–Ω —Å NeoChat –ø–æ–¥–∫–ª—é—á–µ–Ω –∫ Desktop –ø–æ Bluetooth/WiFi
   –∏ –≤—ã—Å—Ç—É–ø–∞–µ—Ç SMS-—à–ª—é–∑–æ–º
2. **USB-–º–æ–¥–µ–º** ‚Äî Desktop —Å GSM-–º–æ–¥–µ–º–æ–º –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç SMS —á–µ—Ä–µ–∑ AT-–∫–æ–º–∞–Ω–¥—ã
3. **SMS API** ‚Äî —Å–µ—Ä–≤–∏—Å —Ç–∏–ø–∞ Twilio (–Ω–æ —ç—Ç–æ —Å–µ—Ä–≤–µ—Ä, –Ω–∞—Ä—É—à–∞–µ—Ç P2P)

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è: Android Companion

```
Desktop ‚Üê‚Üí Bluetooth/LAN ‚Üê‚Üí Android NeoChat
                                    ‚Üì
                              SmsManager.sendTextMessage()
                                    ‚Üì
                              –û–ø–µ—Ä–∞—Ç–æ—Ä –°–ú–°
                                    ‚Üì
                              –ê–±–æ–Ω–µ–Ω—Ç –ë
```

## –§–æ—Ä–º–∞—Ç SMS-—Å–æ–æ–±—â–µ–Ω–∏—è

```
NEO|v1|{nonce_base64}|{ciphertext_base64}
```

- `NEO` ‚Äî –º–∞—Ä–∫–µ—Ä, —á—Ç–æ —ç—Ç–æ –Ω–µ –æ–±—ã—á–Ω–∞—è –°–ú–°
- `v1` ‚Äî –≤–µ—Ä—Å–∏—è –ø—Ä–æ—Ç–æ–∫–æ–ª–∞
- `nonce` ‚Äî 12 –±–∞–π—Ç (16 —Å–∏–º–≤–æ–ª–æ–≤ Base64)
- `ciphertext` ‚Äî –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç

–ï—Å–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª–∏–Ω–Ω–µ–µ –æ–¥–Ω–æ–π –°–ú–°:
```
NEO|v1|1/3|{nonce}|{chunk}
NEO|v1|2/3||{chunk}
NEO|v1|3/3||{chunk}
```

## –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö (—É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ Rust)

```rust
pub enum TransportMode {
    Internet,  // P2P encrypted
    Sms,       // SMS fallback
}

pub struct Chat {
    // ...
    pub transport: TransportMode,  // ‚úÖ –¥–æ–±–∞–≤–ª–µ–Ω–æ
}

pub struct Message {
    // ...
    pub transport: TransportMode,  // ‚úÖ –¥–æ–±–∞–≤–ª–µ–Ω–æ
}

pub struct Contact {
    // ...
    pub phone_number: Option<String>,  // ‚úÖ –¥–æ–±–∞–≤–ª–µ–Ω–æ
}
```

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –≠—Ç–∞–ø 1 (–¢–µ–∫—É—â–∏–π) ‚úÖ
- [x] –ú–æ–¥–µ–ª—å TransportMode –≤ Rust
- [x] –ü–æ–ª–µ transport –≤ Chat –∏ Message
- [x] –ü–æ–ª–µ phone_number –≤ Contact
- [x] API: set_chat_transport, add_contact_with_phone
- [x] TypeScript —Ç–∏–ø—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã
- [x] Tauri-–∫–æ–º–∞–Ω–¥—ã –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã

### –≠—Ç–∞–ø 2 ‚Äî UI –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è
- [ ] –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è Internet/SMS –≤ —à–∞–ø–∫–µ ChatWindow
- [ ] –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Ä–µ–∂–∏–º–∞ (üåê / üì±) –≤ —Å–ø–∏—Å–∫–µ —á–∞—Ç–æ–≤
- [ ] –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ —Ç–∞—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ SMS
- [ ] –í–≤–æ–¥ –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –≤ –∫–æ–Ω—Ç–∞–∫—Ç–∞—Ö

### –≠—Ç–∞–ø 3 ‚Äî SMS Engine (Android)
- [ ] SmsManager –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ Android Kotlin
- [ ] BroadcastReceiver –¥–ª—è –≤—Ö–æ–¥—è—â–∏—Ö SMS
- [ ] –ü–∞—Ä—Å–∏–Ω–≥ —Ñ–æ—Ä–º–∞—Ç–∞ NEO|v1|...
- [ ] –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ/–¥–µ—à–∏—Ñ—Ä–æ–≤–∫–∞ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ Android

### –≠—Ç–∞–ø 4 ‚Äî Desktop SMS Bridge
- [ ] Bluetooth companion protocol
- [ ] LAN discovery (mDNS)
- [ ] AT-–∫–æ–º–∞–Ω–¥—ã –¥–ª—è USB-–º–æ–¥–µ–º–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
